###############################################
# Telegram Router UI (MarkdownV2 renderer)
#
# How to read this file
# - snippets: small reusable blocks you can include from screens
# - screens: full messages composed of blocks; the app renders these by key
# - Placeholders like {ttl_min}, {table_rows}, {not_found_symbols} are
#   interpolated by the router before sending to Telegram.
#
# Price flow (what renders when)
# - price_prompt: shown when /price is issued without tickers (first prompt),
#   or when no quotes returned AND there are no missing tickers to list.
#
# - price_result: shown when quotes are returned and the result is NOT partial.
# - price_partial_error: shown when quotes are returned AND some tickers could
#   not be found (partial with explicit bullet list).
# - price_partial_note: shown when quotes are returned but upstream marked
#   the result partial and did not provide a list of missing tickers. Shows a
#   short note instead of a bullet list.
# - price_not_found: shown when only invalid tickers are sent (no quotes).
#
# Internals (derivation)
# - The router derives {not_found_symbols} when upstream omits details by
#   comparing requested tickers vs returned rows (prefix match: AMZN -> AMZN.US).
#
# Other screens
# - help: static help landing
# - unknown_input / unknown_command / invalid_template / service_error: generic
#   system messages
# - *_prompt: per-command prompts for missing args
###############################################
snippets:
  symbol_error:
    - paragraph: "‚ö†Ô∏è Unfortunately, I couldn't find quotes for some of the tickers you requested. Please check the list below and update them, or send new ones without rerunning /price."

  session_hint:
    - bullets:
          items:
            - "You can keep sending tickers without rerunning /price. Session ends after {ttl_min} minutes or when you switch commands."
            - "Age shows how current the price is: L = Live, P = Prev close, E = End-of-day, D = Delayed, or a 3-letter code or n/a."
            - "Requesting .US from Europe may only return live prices during US market hours. This is a limitation of the data provider."

  fx_session_hint:
    - bullets:
          items:
            - "You can keep sending currency pairs without rerunning /fx. Session ends after {ttl_min} minutes or when you switch commands."
            - "Rates update live during trading hours."

  fx_pair_error:
    - paragraph: "‚ö†Ô∏è Unfortunately, I couldn't find quotes for some of the currency pairs you requested. Please check the list below and update them, or send new ones without rerunning /fx."

screens:
  # /help - help landing
  help:
    blocks:
      - paragraph: "Commands you can use to manage your portfolio and check markets."
      - spacer: { lines: 1 }
      - subheader: "Market"
      - bullets:
          items:
            - "/price or /p - latest quotes for given tickers"
            - "/fx - live exchange rate for a currency pair"
      - spacer: { lines: 1 }
      - subheader: "Portfolio"
      - bullets:
          items:
            - "/portfolio or /po - fresh snapshot of your holdings"
            - "/po_snapshot - percent return snapshots vs benchmarks"
            - "/po_summary - portfolio value and performance vs benchmarks"
            - "/po_breakdown - holdings level performance vs benchmarks"
            - "/po_digest - overview of returns, benchmarks, movers, allocation"
            - "/po_movers - top gainers & losers"
            - "/allocation - current vs target allocations"
            - "/allocation_edit - adjust target allocations"
            - "/rename - assign or update a nickname for a symbol"
            - "/tx - show last transactions"
            - "/cash - current available cash balance"
            - "/cash_add - add cash balance manually"
            - "/cash_remove - remove cash balance"
      - spacer: { lines: 1 }
      - subheader: "Trading"
      - bullets:
          items:
            - "/buy or /b - record a buy transaction"
            - "/sell or /s - record a sell transaction"
            - "/add - add or increase a position"
            - "/remove - remove a position fully"
            - "/po_if - what-if analysis for price movements"
            - "/cancel - cancel current session"
            - "/exit - exit current conversation"

  # ===================
  # MARKET COMMANDS
  # ===================

  # /price - first prompt (missing args), or no quotes and no missing list
  price_prompt:
    blocks:
      - header: "What tickers should I check?"
      - bullets:
          items:
            - "Enter 1 to 10 tickers, separated by spaces."
            - "For example, enter: NVDA AAPL"
            - "Tickers default to .US (e.g. NVDA). For other markets, add a suffix like TSLA.XETRA to ensure correct currency conversion."
            - "Session auto-closes after {ttl_min} minutes or when you send another command."

  # /price - quotes returned (non-partial)
  price_result:
    blocks:
      - table:
          rows: "{table_rows}"
      - paragraph: "üí° Keep in mind:"
      - include: session_hint

  # /price - quotes returned & partial with explicit missing list
  price_partial_error:
    blocks:
      - table:
          rows: "{table_rows}"
      - include: symbol_error
      - spacer: { lines: 1 }
      - bullets:
          items: "{not_found_symbols}"

  # /price - quotes returned & partial without a list; show short note
  price_partial_note:
    blocks:
      - table:
          rows: "{table_rows}"
      - paragraph: "‚ö†Ô∏è Unfortunately, I couldn't find any valid quotes for a few of the tickers you requested. This may happen if the tickers are incorrect or not supported."
  
  # /price - no quotes and some tickers missing (minimal missing list)
  price_not_found:
    blocks:
      - include: symbol_error
      - spacer: { lines: 1 }
      - bullets:
          items: "{not_found_symbols}"

  # /fx ‚Äì shown when user provides no args. Session stays open to accept the next message.
  fx_prompt:
    blocks:
      - header: "Check a currency pair"
      - bullets:
          items:
            - "Enter a pair with 3-letter codes, separated by a space."
            - "For example, enter: USD EUR"
            - "Session auto-closes after {ttl_min} minutes or when you send another command."

  # /fx ‚Äì success result for any pair BASE/QUOTE
  fx_result:
    blocks:
      - paragraph: "{base} ‚Üí {quote}: {rate}"
      - spacer: { lines: 1 }
      - paragraph: "üí° Keep in mind:"
      - include: fx_session_hint

  # FX-specific errors (e.g., unsupported pair or upstream failure)
  fx_error:
    blocks:
      - paragraph: "‚ö†Ô∏è Unfortunately, I couldn't fetch a valid rate for {base} ‚Üí {quote}. This may happen if the pair isn't supported or the market is unavailable."
      - spacer: { lines: 1 }
      - paragraph: "Try: /fx USD EUR"

  # ===================
  # PORTFOLIO COMMANDS
  # ===================

  # /portfolio ‚Äì empty portfolio guidance for new users
  portfolio_empty:
    blocks:
      - header: "Your portfolio is empty"
      - paragraph: "Get started by adding some positions or cash to track your investments."
      - spacer: { lines: 1 }
      - paragraph: "üí° Quick start options:"
      - bullets:
          items:
            - "Add cash: /cash_add 1000 (adds ‚Ç¨1,000 to your balance)"
            - "Add a position: /add 10 AAPL.US (adds 10 Apple shares to your portfolio)"
            - "Buy shares: /buy 5 MSFT 300 (records 5 Microsoft shares at ‚Ç¨300‚Ç¨ each)"
      - spacer: { lines: 1 }
      - paragraph: "Once you have some positions, use /portfolio to see a snapshot of your holdings."

  # /portfolio ‚Äì portfolio result with positions table
  portfolio_result:
    blocks:
      - header: "üí∞ Total Portfolio Value: {total_value}"
      - spacer: { lines: 1 }
      - table:
          rows: "{table_rows}"
      - bullets:
          items:
            - "Values are shown in EUR and may differ slightly from your broker."
            - "Quotes refresh live during trading hours."
            - "Cash is included in the total value if available."    

  # /portfolio_snapshot ‚Äì optional args prompt
  portfolio_snapshot_prompt:
    blocks:
      - header: "Portfolio snapshot vs benchmarks"
      - bullets:
          items:
            - "Choose period: d (daily), w (weekly), m (monthly), y (yearly)."
            - "Example: /portfolio_snapshot d"
            - "Leave empty for daily snapshot."

  # /portfolio_summary ‚Äì optional args prompt
  portfolio_summary_prompt:
    blocks:
      - header: "Portfolio value and performance summary"
      - bullets:
          items:
            - "Choose period: d (daily), w (weekly), m (monthly), y (yearly)."
            - "Example: /portfolio_summary m"
            - "Leave empty for monthly summary."

  # /portfolio_breakdown ‚Äì optional args prompt
  portfolio_breakdown_prompt:
    blocks:
      - header: "Holdings performance breakdown"
      - bullets:
          items:
            - "Choose period: d (daily), w (weekly), m (monthly), y (yearly)."
            - "Example: /portfolio_breakdown y"
            - "Leave empty for yearly breakdown."

  # /portfolio_digest ‚Äì optional args prompt
  portfolio_digest_prompt:
    blocks:
      - header: "Portfolio digest with top movers"
      - bullets:
          items:
            - "Choose period: d (daily), w (weekly), m (monthly), y (yearly)."
            - "Example: /portfolio_digest m"
            - "Leave empty for monthly digest."

  # /portfolio_movers ‚Äì optional args prompt
  portfolio_movers_prompt:
    blocks:
      - header: "Best and worst performing holdings"
      - bullets:
          items:
            - "Choose period: d (daily), w (weekly), m (monthly), y (yearly)."
            - "Example: /portfolio_movers d"
            - "Leave empty for daily movers."

  # /allocation ‚Äì allocation comparison result
  allocation_result:
    blocks:
      - table:
          rows: "{table_rows}"
      - paragraph: "üí° Keep in mind:"
      - bullets:
          items:
            - "Rebalancing is recommended quarterly or when gaps exceed 5%."
            - "Overconcentration in a single asset or sector increases risk."
            - "Use /allocation_edit to update your targets anytime." 

  # /allocation_edit ‚Äì missing args prompt
  allocation_edit_prompt:
    blocks:
      - header: "Set your target allocation percentages"
      - spacer: { lines: 1 }
      - paragraph: "Your current set targets:"
      - bullets:
          items:
            - "Stocks: {stock_target_pct}%"
            - "ETFs: {etf_target_pct}%"
            - "Crypto: {crypto_target_pct}%"
      - spacer: { lines: 1 }
      - bullets:
          items:
            - "Update by entering Stock %, ETF %, and Crypto % (total must be 100)."
            - "For example: /allocation_edit 30 60 10"

  # /allocation_edit ‚Äì success message
  allocation_edit_success:
    blocks:
      - header: "‚úÖ Allocation targets updated."
      - spacer: { lines: 1 }
      - paragraph: "Your new targets:"
      - bullets:
          items:
            - "Stocks: {stock_target_pct}%"
            - "ETFs: {etf_target_pct}%"
            - "Crypto: {crypto_target_pct}%"

  # /rename ‚Äì missing args prompt
  rename_prompt:
    blocks:
      - header: "Assign a nickname to a holding"
      - bullets:
          items:
            - "Enter ticker and your preferred nickname."
            - "Example: /rename AAPL.US Apple Inc"
            - "Nicknames help you identify holdings more easily."

  # /rename ‚Äì success message
  rename_success:
    blocks:
      - paragraph: "‚úÖ Renamed {symbol} to {nickname}"

  # /tx ‚Äì optional args prompt
  tx_prompt:
    blocks:
      - header: "View your recent transactions"
      - bullets:
          items:
            - "Enter how many transactions to show (1-50)."
            - "Example: /tx 10"
            - "Leave empty to see the last 10 transactions."

  # /tx ‚Äì transaction history result
  tx_result:
    blocks:
      - paragraph: "{transaction_summary}"
      - spacer: { lines: 1 }
      - table:
          rows: "{table_rows}"

  tx_empty:
    blocks:
      - paragraph: "No transactions yet."
      - bullets:
          items:
          - "Add holdings with /add or record trades with /buy and /sell."
          - "Add cash with /cash_add 1000."

  # /cash ‚Äì cash balance result
  cash_result:
    blocks:
      - paragraph: "Cash balance: {cash_balance}"

  cash_zero:
      blocks:
        - paragraph: "Cash balance: 0.00‚Ç¨"
        - bullets:
            items:
            - "Add funds with /cash_add 1000."

  # /cash_add ‚Äì missing args prompt
  cash_add_prompt:
    blocks:
      - header: "Add cash to your portfolio"
      - bullets:
          items:
            - "Enter the amount in EUR"
            - "Example: /cash_add 1000"
            - "This adds 1,000‚Ç¨ to your available cash balance."

  # /cash_add ‚Äì success message
  cash_add_success:
    blocks:
      - paragraph: "‚úÖ Updated cash balance by {amount_display}"

  cash_remove_prompt:
      blocks:
        - header: Remove cash from your account
        - bullets:
            items:
            - "Enter the amount to remove in EUR."
            - "Example: /cash_remove 500"
            - "Reply with Y to confirm or N to cancel."

  cash_remove_confirm:
      blocks:
        - paragraph: "Remove {amount_display} from cash balance?"
        - paragraph: "Reply with Y or N."

  cash_remove_success:
      blocks:
        - paragraph: "‚úÖ Removed {amount_display} from cash balance"

  cash_remove_cancelled:
      blocks:
        - paragraph: "Cash removal cancelled. {amount_display} remains in cash."

  # ===================
  # TRADING COMMANDS
  # ===================

  # /buy ‚Äì missing args prompt
  buy_prompt:
    blocks:
      - header: "Record a buy transaction"
      - bullets:
          items:
            - "Enter quantity, ticker, and price per share in your base currency."
            - "Example: /buy 10 AAPL 150"
            - "This will record a buy of 10 Apple shares at 150‚Ç¨ each."

  # /buy ‚Äì success message
  buy_success:
    blocks:
      - paragraph: "‚úÖ Buy transaction recorded: {symbol} √ó{qty} @ {price_ccy}"

  # /sell ‚Äì missing args prompt
  sell_prompt:
    blocks:
      - header: "Record a sell transaction"
      - bullets:
          items:
            - "Enter quantity, ticker, and price per share in your base currency."
            - "Example: /sell 5 AAPL.US 155"
            - "This will add a sell of 5 Apple shares at $155 each."

  # /sell ‚Äì success message
  sell_success:
    blocks:
      - paragraph: "‚úÖ Sell transaction recorded: {symbol} √ó{qty} @ {price_ccy}"

  # /add ‚Äì missing args prompt
  add_prompt:
    blocks:
      - header: "Add a new position to your portfolio"
      - bullets:
          items:
            - "Enter quantity, symbol, and asset class (stock, etf, or crypto)."
            - "Example: /add 10 AAPL.US stock"
            - "This adds 10 shares of Apple stock to your portfolio."

  # /add ‚Äì success message
  add_success:
    blocks:
      - paragraph: "‚úÖ Added {qty} shares of {symbol} to your portfolio."

  # /remove ‚Äì missing args prompt
  remove_prompt:
    blocks:
      - header: "Remove a position from your portfolio"
      - bullets:
          items:
            - "Enter the ticker you want to remove completely."
            - "Example: /remove AAPL.US"
            - "This removes all Apple shares from your portfolio."

  # /remove ‚Äì success message
  remove_success:
    blocks:
      - paragraph: "‚úÖ Removed all {symbol} positions from your portfolio."

  # /remove ‚Äì not owned
  remove_not_owned:
    blocks:
      - paragraph: "You do not hold *{symbol}* in this portfolio."

  # /po_if ‚Äì missing args prompt
  po_if_prompt:
    blocks:
      - header: "What-if analysis for price movements"
      - bullets:
          items:
            - "Enter a symbol or category and percentage change."
            - "Example: /po_if AAPL.US +5%"
            - "Use stocks, etf, or crypto for entire categories."

  # ===================
  # SYSTEM MESSAGES
  # ===================

  # Unknown input & command
  unknown_input:
    blocks:
      - paragraph: "Hmm, did't catch that. Try /help"

  unknown_command:
    blocks:
      - paragraph: "Unknown command: `{cmd}`"
      - paragraph: "Try /help"

  # Validation errors for prompts (bad input) and upstream errors
  invalid_template:
    blocks:
      - paragraph: "Hmm, that didn't look right - {error}"
      - paragraph: "Try: {usage}"
      - paragraph: "Example: {example}"

  service_error:
    blocks:
      - paragraph: "{message}"
      - paragraph: "Try: {usage}"
      - paragraph: "Example: {example}"

  # Shown when the sender is not in ROUTER_OWNER_IDS
  not_authorized:
    blocks:
      - paragraph: "Not authorized."

  # Shown after /cancel or /exit
  canceled:
    blocks:
      - paragraph: "Okay, closed."

  # Generic success fallback (rarely used)
  done:
    blocks:
      - paragraph: "‚úÖ Done"

